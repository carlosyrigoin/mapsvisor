function list(){1==$("#type").val()?$.get(url+"agricultural_census&user="+$("#user").val()+"&state="+$("#state").val()+"&province="+$("#province").val()+"&district="+$("#district").val()+"&from="+$("#from").val()+"&to="+$("#to").val(),function(e){$("#total").text(e.length),maps(e)},"json"):$.get(url+"crop_monitoring&user="+$("#user").val()+"&state="+$("#state").val()+"&province="+$("#province").val()+"&district="+$("#district").val()+"&from="+$("#from").val()+"&to="+$("#to").val(),function(e){$("#total").text(e.length),maps(e)},"json")}function provinces(){""!=$("#province").val()&&$.get(url+"districts&province="+$("#province").val(),function(e){let t="<option value=''>Selecciona un distrito</option>";for(var o=0;o<e.length;o++)t+="<option value="+e[o].dis_id+">"+e[o].dis_nombre+"</option>";$("#district").empty().html(t)},"json"),list()}function dates(){list()}function maps(e=[]){let t="https://portal.regionsanmartin.gob.pe/server/rest/services/DRASAM/%C3%81mbito_Ma%C3%ADz/MapServer/4";8==$("#zoom").val()&&(t="https://portal.regionsanmartin.gob.pe/server/rest/services/DRASAM/proyecto_visor/MapServer/3"),11==$("#zoom").val()&&(t="https://portal.regionsanmartin.gob.pe/server/rest/services/DRASAM/proyecto_visor/MapServer/4"),require(["esri/config","esri/Map","esri/views/MapView","esri/layers/FeatureLayer","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/Home"],function(o,i,a,r,n,l,s){o.apiKey="AAPKa8da52544c14476c8d3ff27ed1827498UsCounCL4Xx4R6nBo67xs17w3qd3_vZO";let p=new i({basemap:"satellite"}),c=new a({map:p,center:[-76.92070074385694,-6.36497151510392],zoom:$("#zoom").val(),container:"viewDiv"}),d=new r({url:t});p.add(d);let v=new l;p.add(v);for(var u=0;u<e.length;u++){let m=[13,110,253];0==parseInt(e[u].estado)?m=[220,53,69]:1==parseInt(e[u].estado)&&(m=[255,193,7]);let f={type:"point",longitude:e[u].longitud,latitude:e[u].latitud},g={type:"simple-marker",color:m,outline:{color:[255,255,255],width:1}},b=new n({geometry:f,symbol:g,popupTemplate:{title:"Monitoreo de cultivo",content:[{type:"fields",fieldInfos:[{fieldName:"name",label:"Nombres"},{fieldName:"date",label:"Creado"},{fieldName:"syncronize",label:"Sincronizado"},{fieldName:"user",label:"T\xe9cnico"},{fieldName:"province",label:"Provincia"},{fieldName:"district",label:"Distrito"},{fieldName:"location",label:"Localidad"},{fieldName:"natural",label:"Natural de"},{fieldName:"point",label:"Lat / Lng"}]},{type:"media",mediaInfos:[{title:"<b>Foto</b>",type:"image",value:{sourceURL:"https://oat.pe/agroat/api/images/{photo}"}}]}]}});b.attributes={name:e[u].nombres,date:e[u].fecha,syncronize:e[u].sincronizado,province:e[u].provincia,district:e[u].distrito,location:e[u].localidad+" / "+e[u].sector,natural:e[u].natural,point:e[u].latitud+" / "+e[u].longitud,photo:e[u].foto,user:e[u].tecnico},v.add(b)}var y=new s({view:c});c.ui.add(y,"top-left")})}$(document).ready(function(){$.get(url+"users",function(e){let t="<option value=''>Selecciona un usuario</option>";for(var o=0;o<e.length;o++)t+="<option value="+e[o].usu_id+">"+e[o].usu_nombres+"</option>";$("#user").empty().html(t)},"json"),$.get(url+"provinces&deparment=22",function(e){let t="<option value=''>Selecciona una provincia</option>";for(var o=0;o<e.length;o++)t+="<option value="+e[o].pro_id+">"+e[o].pro_nombre+"</option>";$("#province").empty().html(t)},"json"),list()});
